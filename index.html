// --- 1. 設定情報 ---
        const CLIENT_ID = '608274366128-81rjc0e64h0qkj9rv80peeid0jioe421.apps.googleusercontent.com';
        const API_KEY = 'AQ.Ab8RN6LpPVy9Og3toEtqRzt1h5dGXaTa78fnVGyy5Bn7tyxJvQ'; // ※ここにご自身のAPIキーを正確に入れてください
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let gapiInited = false;
        let gsiInited = false;

        const player = document.getElementById('mainPlayer');
        const playlist = document.getElementById('playlist');
        const currentTitle = document.getElementById('currentTitle');
        const fileInput = document.getElementById('fileInput');
        const titleInput = document.getElementById('titleInput');
        const uploadBtn = document.getElementById('uploadBtn');

        function gapiLoaded() {
            gapi.load('client', async () => {
                await gapi.client.init({ apiKey: API_KEY, discoveryDocs: [DISCOVERY_DOC] });
                gapiInited = true;
            });
        }

        function gsiLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', 
            });
            gsiInited = true;
        }

        // リストに追加する大事な関数
        function addVideoToList(title, url) {
            const item = document.createElement('div');
            item.className = 'video-item';
            item.innerHTML = `
                <div class="thumbnail" style="background:#333; display:flex; align-items:center; justify-content:center;">DRIVE</div>
                <div class="video-details">
                    <h4>${title}</h4>
                    <p style="font-size: 12px; color: #aaa; margin: 4px 0 0;">Cloud Storage</p>
                </div>
            `;
            item.onclick = () => {
                player.src = url;
                currentTitle.innerText = title;
                player.play();
            };
            playlist.prepend(item);
        }

        async function uploadToDrive(file, title) {
            tokenClient.callback = async (response) => {
                const metadata = { name: title, mimeType: file.type };
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                const res = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + response.access_token }),
                    body: form
                });
                const fileData = await res.json();
                const videoUrl = `https://www.googleapis.com/drive/v3/files/${fileData.id}?alt=media&key=${API_KEY}`;
                addVideoToList(title, videoUrl);
                alert('アップロード完了！');
            };
            tokenClient.requestAccessToken({ prompt: 'consent' });
        }

        uploadBtn.onclick = () => {
            const file = fileInput.files[0];
            const title = titleInput.value;
            if (file && title) {
                uploadToDrive(file, title);
            }
        };

        // 【ここが重要！】ページを開いた時にサンプルを表示する
        addVideoToList("サンプル動画 (Big Buck Bunny)", "https://www.w3schools.com/html/mov_bbb.mp4");
